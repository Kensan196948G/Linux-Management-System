# 機能要件定義書

**文書番号**: WEBUI-REQ-002
**バージョン**: 1.0
**作成日**: 2026-02-25
**対象システム**: Linux管理 WebUI サンプルシステム

---

## 1. 参照系機能

### 1.1 ダッシュボード

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| DASH-001 | リソース概要表示 | CPU使用率・メモリ使用率・ディスク使用率をグラフ表示 | 必須 |
| DASH-002 | サービス状態サマリー | 重要サービスの稼働状況一覧（稼働中/停止/警告） | 必須 |
| DASH-003 | 最近の操作ログ | 直近10件の操作履歴表示 | 必須 |
| DASH-004 | システム情報 | ホスト名・OS・カーネルバージョン・稼働時間 | 必須 |
| DASH-005 | アラート通知 | 閾値超過時の警告表示（CPU>80%、ディスク>90%等） | 推奨 |

### 1.2 システムリソース監視

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| MON-001 | CPU使用率モニタリング | コア別CPU使用率のリアルタイム表示（5秒更新） | 必須 |
| MON-002 | メモリ使用状況 | 物理メモリ・スワップの使用量・使用率 | 必須 |
| MON-003 | ディスク使用状況 | マウント別ディスク使用量・使用率 | 必須 |
| MON-004 | ネットワーク状態 | NIC別送受信バイト数・パケット数 | 必須 |
| MON-005 | システム負荷 | ロードアベレージ（1分/5分/15分） | 必須 |
| MON-006 | 履歴グラフ | 過去24時間のリソース使用推移グラフ | 推奨 |

### 1.3 サービス管理（参照）

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| SVC-001 | サービス一覧 | systemctl list-units 結果の表示 | 必須 |
| SVC-002 | サービス詳細 | 特定サービスのstatusログ表示 | 必須 |
| SVC-003 | サービス設定確認 | unit ファイル内容の参照（読み取り専用） | 推奨 |
| SVC-004 | 依存関係表示 | サービス依存関係のツリー表示 | 任意 |

### 1.4 プロセス管理（参照のみ）

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| PROC-001 | プロセス一覧 | ps aux 相当の表示（CPU/メモリ順ソート） | 必須 |
| PROC-002 | プロセス検索 | プロセス名・PIDによるフィルタリング | 必須 |
| PROC-003 | プロセス詳細 | 特定PIDの詳細情報（/proc/[pid] 参照） | 推奨 |

> **注意**: プロセスの kill/停止 操作は提供しない（禁止機能）

### 1.5 ログ閲覧

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| LOG-001 | systemdジャーナルログ | journalctl 出力のフィルタリング・ページング表示 | 必須 |
| LOG-002 | アプリケーションログ | 許可済みログファイル（/var/log/配下）の閲覧 | 必須 |
| LOG-003 | 操作監査ログ | 本システムの操作ログ閲覧 | 必須 |
| LOG-004 | ログ検索 | キーワード・日時範囲・レベルによる検索 | 必須 |
| LOG-005 | ログエクスポート | CSV/JSON 形式でのダウンロード | 推奨 |

---

## 2. 操作系機能（限定）

### 2.1 サービス操作

| 機能ID | 機能名 | 説明 | 制御方針 | 優先度 |
|--------|--------|------|---------|--------|
| OP-001 | サービス再起動 | 許可リスト内サービスの restart | Operator以上 | 必須 |
| OP-002 | サービス開始 | 停止中サービスの start | Operator以上 | 推奨 |
| OP-003 | サービス停止 | 実行中サービスの stop | Approver承認必須 | 推奨 |
| OP-004 | サービス有効化/無効化 | enable/disable | Admin承認必須 | 任意 |

**許可リスト例（変更には設計変更手順が必要）**:
- nginx
- apache2
- mysql
- postgresql
- redis-server
- cron

### 2.2 ユーザー・グループ管理

| 機能ID | 機能名 | 説明 | 制御方針 | 優先度 |
|--------|--------|------|---------|--------|
| USR-001 | ユーザー一覧表示 | /etc/passwd 参照（パスワードハッシュ非表示） | 全ロール | 必須 |
| USR-002 | グループ一覧表示 | /etc/group 参照 | 全ロール | 必須 |
| USR-003 | ユーザー追加 | 定義済みテンプレートによる追加 | Admin承認必須 | 推奨 |
| USR-004 | ユーザー無効化 | アカウントのロック（削除は禁止） | Approver承認 | 推奨 |
| USR-005 | グループメンバー管理 | グループへの追加/削除 | Admin承認必須 | 推奨 |

> **注意**: sudo権限の直接付与は管理者が手動で実施（WebUI経由では不可）

### 2.3 スケジュールタスク（cron）管理

| 機能ID | 機能名 | 説明 | 制御方針 | 優先度 |
|--------|--------|------|---------|--------|
| CRON-001 | cronジョブ一覧 | 登録済みcronジョブの一覧表示 | 全ロール | 必須 |
| CRON-002 | cronジョブ詳細 | 特定ジョブの設定確認 | 全ロール | 必須 |
| CRON-003 | cronジョブ有効/無効 | ジョブの有効化・無効化（許可リスト内） | Approver承認 | 推奨 |

---

## 3. 管理・監査機能

### 3.1 操作ログ・監査証跡

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| AUD-001 | 全操作ログ記録 | 誰が・いつ・どのAPIを・何の引数で実行 | 必須 |
| AUD-002 | 実行結果記録 | stdout / stderr / 終了コード | 必須 |
| AUD-003 | ログ改ざん防止 | 追記専用ログ（既存レコードの変更禁止） | 必須 |
| AUD-004 | 監査レポート出力 | 期間指定でのCSV/JSON エクスポート | 推奨 |
| AUD-005 | ログ長期保管 | 最低1年間の保管（ローテーション管理） | 必須 |

### 3.2 承認フロー

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| APV-001 | 操作申請 | Operatorが危険操作を申請 | 推奨 |
| APV-002 | 承認通知 | 承認者へのメール/内部通知 | 推奨 |
| APV-003 | 承認/却下 | Approverが申請を承認または却下 | 推奨 |
| APV-004 | 承認履歴 | 承認・却下の全履歴保管 | 推奨 |
| APV-005 | 有効期限管理 | 承認の有効期限（例: 24時間） | 推奨 |

### 3.3 WebUIロール管理

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| ROLE-001 | ロール定義 | Viewer / Operator / Approver / Admin の4段階 | 必須 |
| ROLE-002 | ユーザーロール割当 | WebUIアクセスユーザーへのロール設定 | 必須 |
| ROLE-003 | ロール変更ログ | ロール変更の証跡記録 | 必須 |

---

## 4. 機能制限マトリクス

| 機能 | Viewer | Operator | Approver | Admin |
|-----|--------|----------|----------|-------|
| ダッシュボード閲覧 | ✅ | ✅ | ✅ | ✅ |
| リソース監視 | ✅ | ✅ | ✅ | ✅ |
| ログ閲覧 | ✅ | ✅ | ✅ | ✅ |
| サービス再起動 | ❌ | ✅ | ✅ | ✅ |
| サービス停止（承認後） | ❌ | 申請のみ | ✅ | ✅ |
| ユーザー追加（承認後） | ❌ | ❌ | 申請のみ | ✅ |
| ロール管理 | ❌ | ❌ | ❌ | ✅ |
| システム設定変更 | ❌ | ❌ | ❌ | ✅ |

---

## 5. 入力値バリデーション要件

| 入力種別 | 許可パターン | 禁止文字 |
|---------|------------|---------|
| サービス名 | `^[a-zA-Z0-9\-_\.]+$` | `;|&$()` 等 |
| ユーザー名 | `^[a-z][a-z0-9\-_]{0,31}$` | 大文字・記号 |
| 日時パラメータ | ISO 8601形式のみ | 任意文字列 |
| ログ検索キーワード | 最大256文字 | メタ文字 |

---

*本文書はLinux管理WebUIサンプルシステムの機能要件を定めるものである。*
