# 変更管理・バージョン管理仕様書

**文書番号**: WEBUI-CHG-001
**バージョン**: 1.0
**作成日**: 2026-02-25
**対象システム**: Linux管理 WebUI サンプルシステム

---

## 1. 変更管理方針

### 1.1 基本方針

本システムはLinux管理機能を持つため、変更管理は特に厳格に実施する。

- **全変更を記録**: コード・設定・インフラの変更はすべて記録
- **承認フロー必須**: 本番環境への変更は必ず承認を経ること
- **テスト完了後のみリリース**: 未テスト変更のリリース禁止
- **ロールバック計画必須**: リリース前に切り戻し手順を確認

### 1.2 変更カテゴリー

| カテゴリ | 説明 | 承認者 | リードタイム |
|---------|------|--------|------------|
| 緊急（Critical） | セキュリティ脆弱性・重大障害 | CISO + 部長 | 即時〜2時間 |
| 標準（Standard） | 機能追加・変更・修正 | システム管理者 | 5営業日 |
| 軽微（Minor） | ドキュメント・UI文言修正 | 開発リーダー | 2営業日 |
| 設定変更（Config） | 設定ファイル・allowlist変更 | システム管理者 | 3営業日 |

---

## 2. 変更フロー

### 2.1 標準変更フロー

```
1. 課題/要望の起票（GitHub Issues）
        ↓
2. 影響範囲の調査・設計
        ↓
3. 変更管理票（RFC）の作成
        ↓
4. レビュー・承認（ステークホルダー）
        ↓
5. 開発・実装
        ↓
6. テスト実施（ユニット・統合・E2E）
        ↓
7. セキュリティレビュー（必要な場合）
        ↓
8. ステージング環境での動作確認
        ↓
9. リリース承認
        ↓
10. 本番リリース
        ↓
11. リリース後確認・監視
        ↓
12. クローズ・記録
```

### 2.2 緊急変更フロー

```
1. インシデント検知・報告
        ↓
2. 緊急変更承認（CISO + 部長：口頭 → 事後書面）
        ↓
3. 修正実施・最小限のテスト
        ↓
4. リリース（ロールバック準備必須）
        ↓
5. 事後レビュー・報告書作成（24時間以内）
```

---

## 3. 変更管理票（RFC: Request for Change）

### 3.1 RFC 必須記載事項

```markdown
## 変更管理票 RFC-YYYY-NNN

### 基本情報
- 申請者:
- 申請日:
- 変更カテゴリ: 緊急 / 標準 / 軽微 / 設定変更
- 希望リリース日:

### 変更概要
- 変更理由・背景:
- 変更内容:
- 影響範囲:

### リスクアセスメント
- リスクレベル: 高 / 中 / 低
- リスク内容:
- リスク軽減策:

### テスト計画
- 実施テスト:
- テスト環境:
- 合格基準:

### ロールバック計画
- ロールバックトリガー:
- ロールバック手順:
- ロールバック所要時間:

### 承認
- 承認者:
- 承認日:
- 承認コメント:
```

---

## 4. バージョン管理規則

### 4.1 セマンティックバージョニング

`MAJOR.MINOR.PATCH`（例: `1.2.3`）

| バージョン種別 | 変更内容 |
|-------------|---------|
| MAJOR | 後方互換性のない大きな変更（API仕様変更・DB再構築等） |
| MINOR | 後方互換性のある機能追加（新API追加・新画面追加） |
| PATCH | バグ修正・セキュリティパッチ・マイナー修正 |

**バージョン例**:
- `0.1.0`: 参照系機能のみ（最初のリリース）
- `0.2.0`: サービス操作機能追加
- `0.3.0`: 承認フロー実装
- `1.0.0`: 本番運用開始（全機能安定）
- `1.0.1`: バグ修正
- `1.1.0`: 新機能追加

### 4.2 Git タグ規則

```bash
# リリースタグ
git tag -a v1.2.3 -m "Release v1.2.3: サービス停止承認フロー追加"
git push origin v1.2.3

# タグ一覧
git tag -l "v*"
```

### 4.3 ブランチ保護ルール

| ブランチ | 保護設定 |
|---------|---------|
| `main` | 直接プッシュ禁止・PR必須・2名以上のレビュー・CI通過必須 |
| `develop` | 直接プッシュ禁止・PR必須・1名以上のレビュー |
| `feature/*` | 制限なし（開発者の個人ブランチ） |

---

## 5. 重要変更の追加要件

### 5.1 セキュリティ関連変更

以下の変更は **セキュリティレビュー必須**:

- sudo allowlist の変更（追加・削除）
- 認証・認可ロジックの変更
- JWT シークレット・暗号化キーの変更
- ラッパースクリプトの変更
- 新規APIエンドポイントの追加
- CORS・CSP設定の変更

**セキュリティレビュー実施者**: セキュリティチーム + 開発リーダー

### 5.2 allowlist 変更手順

```yaml
# config/allowlist.yaml
# 変更には RFC + セキュリティレビュー必須

services:
  - name: nginx
    allow_restart: true
    allow_start: true
    allow_stop: true
    requires_approval_for_stop: true
    change_log:
      - date: "2026-02-25"
        by: "admin01"
        rfc: "RFC-2026-001"
        note: "初期登録"
```

### 5.3 データベーススキーマ変更

- マイグレーションスクリプトを必ず作成
- ロールバック用マイグレーションも作成
- 本番適用前にステージングで検証
- 監査ログテーブルへの変更は原則禁止

---

## 6. リリースノート作成規則

### 6.1 フォーマット

```markdown
# Release Notes - v1.2.3

**リリース日**: 2026-03-01
**変更種別**: 機能追加

## 変更サマリー

- サービス停止の承認フローを実装
- ダッシュボードのリアルタイム更新間隔を60秒→30秒に変更
- ログイン失敗時のエラーメッセージを改善

## 新機能

- 承認フロー: Operator から Approver への申請機能を追加
- 承認通知: 申請時にメール通知を送信

## 変更

- ダッシュボード更新間隔: 60秒 → 30秒

## バグ修正

- ログ検索で日本語キーワードが正しく動作しない問題を修正

## セキュリティ

- 特記事項なし

## 既知の問題

- 大量ログ（100万行以上）の検索が遅い場合がある（次バージョンで改善予定）

## アップグレード手順

1. 通常のデプロイ手順に従ってください（10_deployment-procedure.md）
2. マイグレーションが自動実行されます
3. 特別な設定変更は不要です
```

---

## 7. 変更履歴（本ドキュメント）

| バージョン | 日付 | 変更者 | 変更内容 |
|----------|------|--------|---------|
| 1.0 | 2026-02-25 | 情報システム部 | 初版作成 |

---

*本文書はLinux管理WebUIサンプルシステムの変更管理・バージョン管理仕様を定めるものである。*
