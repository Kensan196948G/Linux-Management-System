<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€é–‹ç™ºã€‘Linux Management System - ãƒ­ã‚°ã‚¤ãƒ³</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
    <div class="card" style="max-width: 450px; width: 100%; margin: 2rem;">
        <div style="text-align: center; margin-bottom: 2rem;">
            <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ–¥ï¸ Linuxç®¡ç†é‹ç”¨ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p style="color: var(--text-secondary);">
                <span class="env-badge dev">ã€é–‹ç™ºã€‘</span>
            </p>
        </div>

        <h2 class="card-title" style="text-align: center;">ãƒ­ã‚°ã‚¤ãƒ³</h2>

        <div id="login-alerts"></div>

        <form id="login-form">
            <div class="form-group">
                <label class="form-label" for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" class="form-input" id="email" value="operator@example.com" required autocomplete="username">
            </div>
            <div class="form-group">
                <label class="form-label" for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" class="form-input" id="password" value="operator123" required autocomplete="current-password">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </form>

        <div style="margin-top: 1.5rem; padding: 1rem; background-color: #f1f5f9; border-radius: 6px;">
            <p style="font-size: 0.875rem; color: var(--text-secondary); font-weight: 600; margin-bottom: 0.5rem;">é–‹ç™ºç’°å¢ƒç”¨ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:</p>
            <ul style="font-size: 0.875rem; color: var(--text-secondary); margin: 0; list-style: none; padding: 0;">
                <li style="padding: 0.25rem 0;">ğŸ‘ï¸ viewer@example.com / viewer123 (Viewer)</li>
                <li style="padding: 0.25rem 0;">âš™ï¸ operator@example.com / operator123 (Operator)</li>
                <li style="padding: 0.25rem 0;">ğŸ”§ admin@example.com / admin123 (Admin)</li>
            </ul>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../js/api.js"></script>
    <script>
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®å‡¦ç†
        document.getElementById('login-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const alertsEl = document.getElementById('login-alerts');
            const submitBtn = event.target.querySelector('button[type="submit"]');

            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            submitBtn.disabled = true;
            submitBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';

            try {
                console.log('Attempting login for:', email);

                // ãƒ­ã‚°ã‚¤ãƒ³
                const result = await api.login(email, password);

                console.log('Login successful:', result);

                // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
                alertsEl.innerHTML = '<div class="alert alert-success">âœ… ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸã€‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ç§»å‹•ã—ã¾ã™...</div>';

                // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                setTimeout(() => {
                    console.log('Redirecting to dashboard...');
                    window.location.href = '/dev/dashboard.html';
                }, 1000);

            } catch (error) {
                console.error('Login failed:', error);
                alertsEl.innerHTML = `<div class="alert alert-error">âŒ ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message || 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼'}</div>`;

                // ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹åŒ–
                submitBtn.disabled = false;
                submitBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
            }
        });

        // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        if (api.isAuthenticated()) {
            console.log('Already authenticated, checking token validity...');
            api.getCurrentUser().then((user) => {
                console.log('Token valid, redirecting to dashboard...', user);
                window.location.href = '/dev/dashboard.html';
            }).catch((error) => {
                // ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ãªå ´åˆã¯ã‚¯ãƒªã‚¢
                console.warn('Token invalid, clearing...', error);
                api.clearToken();
                // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                window.location.reload();
            });
        } else {
            console.log('Not authenticated, showing login form');
        }
    </script>
</body>
</html>
