<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron Jobs - Linux Management System</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/sidebar.css">
    <link href="../vendor/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="../vendor/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Cronã‚¸ãƒ§ãƒ–ãƒ†ãƒ¼ãƒ–ãƒ«å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .cron-table {
            width: 100%;
            font-size: 14px;
        }

        .cron-table th {
            background-color: #2c3e50;
            color: white;
            padding: 10px 8px;
            font-weight: bold;
            border-bottom: 2px solid #34495e;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .cron-table td {
            padding: 8px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: middle;
        }

        .cron-table tr:hover {
            background-color: #f8f9fa;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        .controls-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .control-group label {
            font-size: 12px;
            font-weight: 600;
            color: #555;
        }

        .control-group select,
        .control-group input {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        /* ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .schedule-preview {
            font-size: 13px;
            padding: 8px 12px;
            background-color: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 4px;
            margin-top: 4px;
        }

        /* Cronå¼å†…è¨³ã‚°ãƒªãƒƒãƒ‰ */
        .cron-breakdown {
            display: inline-grid;
            grid-template-columns: repeat(5, auto);
            gap: 2px 6px;
            font-size: 10px;
            margin-top: 3px;
        }
        .cron-field-label { color: #6b7280; text-align: center; }
        .cron-field-value { background: #e0f2fe; color: #0369a1; border-radius: 3px;
                            padding: 1px 5px; text-align: center; font-weight: 600;
                            font-family: monospace; font-size: 11px; }

        /* å±é™ºã‚³ãƒãƒ³ãƒ‰ãƒãƒƒã‚¸ */
        .danger-badge {
            display: inline-block;
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
            border-radius: 4px;
            font-size: 11px;
            padding: 1px 6px;
            margin-left: 4px;
            font-weight: 600;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
        .badge-enabled { background-color: #10b981; }
        .badge-disabled { background-color: #6b7280; }

        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats-card {
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }

        .stat-item {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .stat-value {
            font-size: 22px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- å·¦å´ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <aside class="sidebar" id="sidebar-container"></aside>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="main-content">
            <div class="main-header">
                <h2 id="page-title">ğŸ“… Cronã‚¸ãƒ§ãƒ–ç®¡ç†</h2>
            </div>

            <div class="main-body" id="main-body">
                <!-- ã‚¢ãƒ©ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
                <div id="cronAlertContainer"></div>

                <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ -->
                <div class="controls-bar">
                    <div class="control-group">
                        <label for="cronUserSelect">å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼</label>
                        <select id="cronUserSelect" class="form-select form-select-sm" style="min-width: 200px;">
                            <option value="">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ...</option>
                        </select>
                    </div>

                    <div class="control-group" style="margin-left: auto;">
                        <label>&nbsp;</label>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm btn-primary" id="addCronJobBtn" style="display: none;" disabled>
                                <i class="bi bi-plus-circle"></i> ã‚¸ãƒ§ãƒ–è¿½åŠ 
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="refreshBtn">
                                <i class="bi bi-arrow-clockwise"></i> æ›´æ–°
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="autoRefreshBtn" title="è‡ªå‹•æ›´æ–°: OFF">
                                <i class="bi bi-clock"></i> è‡ªå‹•æ›´æ–°
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span id="cronStatusText" class="text-muted small"></span>
                    <span id="cronLoadingSpinner" style="display: none;">
                        <span class="spinner-border spinner-border-sm"></span> èª­ã¿è¾¼ã¿ä¸­...
                    </span>
                </div>

                <!-- Cronã‚¸ãƒ§ãƒ–ãƒ†ãƒ¼ãƒ–ãƒ« -->
                <div class="table-responsive">
                    <table class="table table-sm table-hover cron-table">
                        <thead>
                            <tr>
                                <th>çŠ¶æ…‹</th>
                                <th>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</th>
                                <th>ã‚³ãƒãƒ³ãƒ‰</th>
                                <th>å¼•æ•°</th>
                                <th>ã‚³ãƒ¡ãƒ³ãƒˆ</th>
                                <th>æ¬¡å›å®Ÿè¡Œäºˆå®š</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="cronJobsTableBody">
                            <tr>
                                <td colspan="7" class="text-center text-muted py-4">
                                    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- ã‚¸ãƒ§ãƒ–è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal fade" id="addCronJobModal" tabindex="-1" aria-labelledby="addCronJobModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCronJobModalLabel">Cronã‚¸ãƒ§ãƒ–è¿½åŠ </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addCronJobForm">
                    <div class="modal-body">
                        <div id="addJobModalAlert"></div>

                        <div class="mb-3">
                            <label class="form-label">å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼</label>
                            <div class="form-control-plaintext">
                                <strong id="addJobTargetUser">-</strong>
                                <span class="ms-2" id="addJobRemaining"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="schedulePreset" class="form-label">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ—ãƒªã‚»ãƒƒãƒˆ</label>
                            <select class="form-select" id="schedulePreset">
                                <option value="">ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é¸æŠ...</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="cronSchedule" class="form-label">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆCronå¼ï¼‰</label>
                            <input type="text" class="form-control font-monospace" id="cronSchedule" required
                                placeholder="åˆ† æ™‚ æ—¥ æœˆ æ›œæ—¥  (ä¾‹: 0 2 * * *)">
                            <div id="schedulePreview" class="form-text"></div>
                            <div class="form-text text-muted">*/1 ~ */4 ã¯ç¦æ­¢ï¼ˆæœ€ä½ */5 åˆ†é–“éš”ï¼‰</div>
                        </div>

                        <div class="mb-3">
                            <label for="cronCommand" class="form-label">ã‚³ãƒãƒ³ãƒ‰ï¼ˆAllowlistï¼‰</label>
                            <select class="form-select" id="cronCommand" required>
                                <option value="">ã‚³ãƒãƒ³ãƒ‰ã‚’é¸æŠ...</option>
                            </select>
                            <div class="form-text text-muted">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã€è¨±å¯ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã®ã¿é¸æŠå¯èƒ½ã§ã™</div>
                        </div>

                        <div class="mb-3">
                            <label for="cronArguments" class="form-label">å¼•æ•°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                            <input type="text" class="form-control font-monospace" id="cronArguments"
                                maxlength="512" placeholder="ä¾‹: -avz /data /backup/data">
                            <div class="form-text text-muted">ç¦æ­¢æ–‡å­—: ; | & $ ( ) ` { } [ ] ãŠã‚ˆã³ .. (ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«)</div>
                        </div>

                        <div class="mb-3">
                            <label for="cronComment" class="form-label">ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                            <input type="text" class="form-control" id="cronComment"
                                maxlength="256" placeholder="ä¾‹: Daily data backup">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button type="submit" class="btn btn-primary" id="submitAddCronJob">è¿½åŠ </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../vendor/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="../js/env-config.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/sidebar.js"></script>
<script>document.readyState==='loading'?document.addEventListener('DOMContentLoaded',()=>renderSidebar('cron')):renderSidebar('cron');</script>
    <script src="../js/cron.js"></script>
    <script>
        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆé–¢æ•°
        function logout() {
            localStorage.removeItem('access_token');
            window.location.href = window.location.pathname.replace(/[^/]*$/, '') + 'index.html';
        }
    </script>
</body>
</html>
