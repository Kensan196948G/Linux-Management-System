# Skill: security-audit
# Linux Management System - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã‚¹ã‚­ãƒ«

## ðŸ“‹ ã‚¹ã‚­ãƒ«èª¬æ˜Ž

ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã«å¯¾ã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦³ç‚¹ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã„ã¾ã™ã€‚
CLAUDE.md ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŽŸå‰‡ã«åŸºã¥ã„ã¦ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

## ðŸ” è‡ªå‹•ãƒã‚§ãƒƒã‚¯é …ç›®

### 1. å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º
```bash
# ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
grep -rn "shell=True" backend/           # â†’ å³FAIL
grep -rn 'os\.system\(' backend/         # â†’ å³FAIL
grep -rn '\beval\b' backend/             # â†’ å³FAIL
grep -rn '\bexec\b' backend/             # â†’ è¦ç¢ºèª
grep -rn "bash -c" wrappers/             # â†’ å³FAIL
```

### 2. å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
```python
# ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å—ã‘å–ã‚‹å…¨ã¦ã®ç®‡æ‰€ã§ validate_input() ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹
# ç‰¹æ®Šæ–‡å­—ãƒã‚§ãƒƒã‚¯ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
FORBIDDEN_CHARS = [";", "|", "&", "$", "(", ")", "`", ">", "<", "*", "?"]
```

### 3. èªè¨¼ãƒ»èªå¯ç¢ºèª
```python
# å…¨ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§:
# - current_user = Depends(get_current_user) ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
# - require_permission() ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹
```

### 4. ç›£æŸ»ãƒ­ã‚°ç¢ºèª
```python
# æ“ä½œç³»ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆPOST/PUT/DELETEï¼‰ã§:
# - audit_log.record() ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹
# - å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆuser, operation, target, resultï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
```

### 5. sudo wrapper ç¢ºèª
```bash
# wrappers/*.sh ã§:
# - set -euo pipefail ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
# - allowlist ãƒã‚§ãƒƒã‚¯ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
# - ç‰¹æ®Šæ–‡å­—ãƒã‚§ãƒƒã‚¯ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
# - ç›´æŽ¥ systemctl/useradd ç­‰ã‚’å‘¼ã‚“ã§ã„ãªã„ã‹ (sudo wrapper çµŒç”±ã‹)
```

## ðŸ“Š ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢åŸºæº–

| ã‚¹ã‚³ã‚¢ | æ¡ä»¶ |
|--------|------|
| âœ… PASS | å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³0ä»¶ã€èªè¨¼100%ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³100%ã€ç›£æŸ»ãƒ­ã‚°100% |
| âš ï¸ WARN | è»½å¾®ãªå•é¡Œï¼ˆãƒ­ã‚°ä¸è¶³ç­‰ï¼‰- ä¿®æ­£æŽ¨å¥¨ |
| âŒ FAIL | å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºã€èªè¨¼æ¬ è½ã€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ |

## ðŸš€ ä½¿ç”¨æ–¹æ³•

æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«å‚ç…§ã—ã¦ãã ã•ã„ï¼š
1. ä¸Šè¨˜ãƒã‚§ãƒƒã‚¯é …ç›®ã‚’å…¨ã¦ç¢ºèª
2. bandit ã§ã‚¹ã‚­ãƒ£ãƒ³: `bandit -r backend/ -ll`
3. shellcheck ã§ã‚¹ã‚­ãƒ£ãƒ³: `shellcheck wrappers/*.sh`
